/*!
 *   Check Character Calculator - Find check character of a location
 *   Copyright (C) 2020 Dylan Wilson
 *
 *   This program is free software: you can redistribute it and/or modify
 *   it under the terms of the GNU General Public License as published by
 *   the Free Software Foundation, either version 3 of the License, or
 *   (at your option) any later version.
 *
 *   This program is distributed in the hope that it will be useful,
 *   but WITHOUT ANY WARRANTY; without even the implied warranty of
 *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *   GNU General Public License for more details.
 *
 *   You should have received a copy of the GNU General Public License
 *   along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */
;const letters=["ALPHA","BRAVO","CHARLIE","DELTA","ECHO","FOXTROT","GOLF","HOTEL","INDIA","JULIET","KILO","LIMA","MIKE","NOVEMBER","OSCAR","PAPA","QUEBEC","ROMEO","SIERRA","TANGO","UNIFORM","VICTOR","WHISKEY","X-RAY","YANKEE","ZULU"];const numbers=["ZERO","ONE","TWO","THREE","FOUR","FIVE","SIX","SEVEN","EIGHT","NINE"];const locationDiv=$("#location");const phoneticDiv=$("#phonetic");const checkDiv=$("#check");locationDiv.on("input",function(){$(this).val(filterLocation($(this).val()))});locationDiv.trigger("input");function filterLocation(a){let filtered="";for(let i=0;i<a.length&&i<4;i++){if(a.charAt(i).match(/^[0-9A-Za-z]+$/)||(i===3&&a.charAt(i).match(/^[+-]+$/))){filtered+=a.charAt(i)}}if(!handleSpecialLocation(filtered.toUpperCase())){phoneticDiv.text(filtered.length===0?"NONE":getPhonetic(filtered.toUpperCase()));checkDiv.text(getCheck(filtered.toUpperCase()))}return filtered}function convertToWord(a){a=a.substr(0,1);if(!isNaN(a)){return numbers[a]}return letters[a.toUpperCase().charCodeAt(0)-65]}function getPhonetic(a){let result="";for(let i=0;i<a.length;i++){if(a.substr(i,i+1)!=="+"&&a.substr(i,i+1)!=="+"){result+=convertToWord(a.substr(i,i+1).toUpperCase())}if(i!==a.length-1){result+=" "}}return result}function getCheck(a){if(a.length!==4){return"NONE"}let i=0;for(let j=2;j<6;j++){i+=a.charCodeAt(j%4)*(j%3*2+3)}return convertToWord(String.fromCharCode((i%26)+65))}function handleSpecialLocation(a){if(a.substr(-1)==="+"||a.substr(-1)==="-"){let prefix;switch(a.substr(-1)){case"+":prefix="AFTER ";break;case"-":prefix="BEFORE ";break}if(handleSpecialLocation(a.substr(0,a.length-1))){phoneticDiv.text(prefix+phoneticDiv.text())}else{phoneticDiv.text(prefix+getPhonetic(a.substr(0,a.length-1)))}checkDiv.text(getCheck(a));return true}if(a==="SOB"){phoneticDiv.text("SOB");checkDiv.text("SIERRA");return true}if(a==="DPA"){phoneticDiv.text("DPA");checkDiv.text("VICTOR");return true}if(a==="RETS"){phoneticDiv.text("RETURNS");checkDiv.text(getCheck(a));return true}if(a.substr(0,2)==="CA"){phoneticDiv.text($.trim("CASH OFFICE "+getPhonetic(a.substr(2,4))));checkDiv.text(getCheck(a));return true}if(a.substr(0,2)==="CP"){phoneticDiv.text($.trim("COLLECTION POINT "+getPhonetic(a.substr(2,4))));checkDiv.text(getCheck(a));return true}if(a.substr(0,1)==="J"){phoneticDiv.text($.trim("JEWELLERY "+getPhonetic(a.substr(1,4))));checkDiv.text(getCheck(a));return true}if(a.substr(0,1)==="S"){phoneticDiv.text($.trim("SECURITY "+getPhonetic(a.substr(1,4))));checkDiv.text(getCheck(a));return true}if(a.substr(0,1)==="L"){phoneticDiv.text($.trim(getPhonetic(a.substr(1,2))+" LINBIN "+getPhonetic(a.substr(3,4))));checkDiv.text(getCheck(a));return true}if(a.substr(0,1)==="Z"){phoneticDiv.text($.trim(getPhonetic(a.substr(1,2))+" BULK "+getPhonetic(a.substr(3,4)).trim()));checkDiv.text(getCheck(a));return true}};